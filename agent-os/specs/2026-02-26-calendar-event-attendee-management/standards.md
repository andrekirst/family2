# Standards for Calendar Event Attendee Management

The following standards apply to this work.

---

## backend/graphql-input-command

Separate Input DTOs (primitives) from Commands (Vogen). See ADR-003.

- Input: primitives (string, int, Guid) — Hot Chocolate deserializable
- Command: Vogen value objects (CalendarEventId, UserId) — CQRS domain entity
- MutationType per command (not centralized) in subfolder
- Handler implements `ICommandHandler<TCommand, TResult>` with `ValueTask<T>` return
- Dispatch via `ICommandBus.SendAsync()`

File organization: `Commands/{Name}/Command.cs, Handler.cs, Validator.cs, Result.cs, MutationType.cs`

---

## backend/domain-events

Events extend `DomainEvent` base record. Raised via `RaiseDomainEvent()` on aggregates.

- Events are sealed records extending `DomainEvent`
- Location: `Features/{Module}/Domain/Events/{Name}Event.cs`
- Use past tense: Added, Removed
- Names: `AttendeeAddedToCalendarEventEvent`, `AttendeeRemovedFromCalendarEventEvent`

---

## backend/permission-system

Creator-only permission check pattern (simplified from role-based).

- Handler verifies `calendarEvent.CreatedBy == command.RequestedBy`
- Throws `DomainException` with `DomainErrorCodes.NotEventCreator` when unauthorized
- Frontend hides add/remove controls when current user is not the creator

---

## backend/vogen-value-objects

All domain IDs use Vogen value objects with EfCoreValueConverter.

- `CalendarEventId` and `UserId` used in commands (never raw Guid)
- `CalendarEventId.From(guid)` for conversion in MutationType
- Equality operators generated by Vogen for duplicate checks

---

## backend/user-context

IUserService + ClaimNames pattern for JWT claim extraction.

```csharp
var user = await userService.GetCurrentUser(claimsPrincipal, userRepository, ct);
// user.Id is the internal UserId used for RequestedBy
```

---

## database/ef-core-migrations

No migration needed — existing `calendar.calendar_event_attendees` table with composite key `(CalendarEventId, UserId)` is sufficient. The domain methods operate on the in-memory collection loaded via `GetByIdWithAttendeesAsync`.

---

## frontend/angular-components

Standalone components with signals.

- `isAttendeeLoading = signal(false)` for loading state
- `isCreator = computed(...)` for permission check
- `availableMembers = computed(...)` for filtering already-added members

---

## frontend/apollo-graphql

Apollo Client with typed GraphQL operations.

- `ADD_ATTENDEE` mutation with `gql` tagged template
- `REMOVE_ATTENDEE` mutation with `gql` tagged template
- Service methods: `apollo.mutate()` → `pipe(map, catchError)`

---

## testing/unit-testing

xUnit + FluentAssertions with fake repository pattern.

- `FakeCalendarEventRepository` implementing `ICalendarEventRepository`
- Domain tests: verify collection changes and domain events
- Handler tests: verify permission checks, error cases, repository interactions
- Arrange-Act-Assert pattern consistently
